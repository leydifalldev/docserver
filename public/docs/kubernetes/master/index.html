<!doctype html><html lang=en-us data-dark-mode><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=preload as=font href=fonts/vendor/jost/jost-v4-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=fonts/vendor/jost/jost-v4-latin-500.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=fonts/vendor/jost/jost-v4-latin-700.woff2 type=font/woff2 crossorigin><script>(()=>{var t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,e=localStorage.getItem("theme");localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode",""),t&&e==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script><link rel=stylesheet href=../../../main.f5beddd6e3eb5b106664425cb81e68868d14c2b55d5c3307b318b4af78ac6e6cc99aa3a589912c11e8aabe328d5147a4f49443bdb9916ebcd3f14ecb88c69561.css integrity="sha512-9b7d1uPrWxBmZEJcuB5oho0UwrVdXDMHsxi0r3isbmzJmqOliZEsEeiqvjKNUUek9JRDvbmRbrzT8U7LiMaVYQ==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>Masters - Protobox</title><meta name=description content="1. Présentation #Les masters sont répliqués pour garantir la haute disponibilité du cluster. Dans notre infrastructure, on dispose de 3 masters. Ces derniers sont le socle du Control Plane
2. Composants du Control Plane #Ref: kubernetes documentation
- kube-apiserver #Composant sur le master qui expose l&amp;rsquo;API Kubernetes. Il s&amp;rsquo;agit du front-end pour le plan de contrôle Kubernetes.
Il est conçu pour une mise à l&amp;rsquo;échelle horizontale, ce qui veut dire qu&amp;rsquo;il met à l&amp;rsquo;échelle en déployant des instances supplémentaires."><link rel=canonical href=../../../docs/kubernetes/master/><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="Masters"><meta property="og:description" content="1. Présentation #Les masters sont répliqués pour garantir la haute disponibilité du cluster. Dans notre infrastructure, on dispose de 3 masters. Ces derniers sont le socle du Control Plane
2. Composants du Control Plane #Ref: kubernetes documentation
- kube-apiserver #Composant sur le master qui expose l&rsquo;API Kubernetes. Il s&rsquo;agit du front-end pour le plan de contrôle Kubernetes.
Il est conçu pour une mise à l&rsquo;échelle horizontale, ce qui veut dire qu&rsquo;il met à l&rsquo;échelle en déployant des instances supplémentaires."><meta property="og:url" content="/docs/kubernetes/master/"><meta property="og:site_name" content="Protobox"><meta property="article:published_time" content="2022-12-28T21:48:04+01:00"><meta property="article:modified_time" content="2022-12-28T21:48:04+01:00"><meta property="og:image" content="doks.png"><meta property="og:image:alt" content="Protobox"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@getdoks"><meta name=twitter:creator content="@henkverlinde"><meta name=twitter:title content="Masters"><meta name=twitter:description content><meta name=twitter:image content="doks.png"><meta name=twitter:image:alt content="Masters"><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"Organization","@id":"/#/schema/organization/1","name":"Doks","url":"/","sameAs":["https://twitter.com/getdoks","https://github.com/h-enk/doks"],"logo":{"@type":"ImageObject","@id":"/#/schema/image/1","url":"/logo-doks.png","width":512,"height":512,"caption":"Doks"},"image":{"@id":"/#/schema/image/1"}},{"@type":"WebSite","@id":"/#/schema/website/1","url":"/","name":"Protobox","description":"Doks is a Hugo theme for building secure, fast, and SEO-ready documentation websites, which you can easily update and customize.","publisher":{"@id":"/#/schema/organization/1"}},{"@type":"WebPage","@id":"/docs/kubernetes/master/","url":"/docs/kubernetes/master/","name":"Masters","description":"","isPartOf":{"@id":"/#/schema/website/1"},"about":{"@id":"/#/schema/organization/1"},"datePublished":"2022-12-28T21:48:04CET","dateModified":"2022-12-28T21:48:04CET","breadcrumb":{"@id":"/docs/kubernetes/master/#/schema/breadcrumb/1"},"primaryImageOfPage":{"@id":"/docs/kubernetes/master/#/schema/image/2"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["/docs/kubernetes/master/"]}]},{"@type":"BreadcrumbList","@id":"/docs/kubernetes/master/#/schema/breadcrumb/1","name":"Breadcrumbs","itemListElement":[{"@type":"ListItem","position":1,"item":{"@type":"WebPage","@id":"","url":"","name":"Home"}},{"@type":"ListItem","position":3,"item":{"@type":"WebPage","@id":"/docs/","url":"/docs/","name":"Docs"}},{"@type":"ListItem","position":4,"item":{"@type":"WebPage","@id":"/docs/kubernetes/","url":"/docs/kubernetes/","name":"Kubernetes"}},{"@type":"ListItem","position":5,"item":{"@id":"/docs/kubernetes/master/"}}]},{"@context":"https://schema.org","@graph":[{"@type":"Article","@id":"/#/schema/article/1","headline":"Masters","description":"","isPartOf":{"@id":"/docs/kubernetes/master/"},"mainEntityOfPage":{"@id":"/docs/kubernetes/master/"},"datePublished":"2022-12-28T21:48:04CET","dateModified":"2022-12-28T21:48:04CET","author":{"@id":"/#/schema/person/2"},"publisher":{"@id":"/#/schema/organization/1"},"image":{"@id":"/docs/kubernetes/master/#/schema/image/2"}}]},{"@context":"https://schema.org","@graph":[{"@type":"Person","@id":"/#/schema/person/2","name":"Henk Verlinde","sameAs":["https://twitter.com/henkverlinde","https://www.linkedin.com/in/henkverlinde/","https://github.com/h-enk"]}]},{"@context":"https://schema.org","@graph":[{"@type":"ImageObject","@id":"/docs/kubernetes/master/#/schema/image/2","url":"doks.png","contentUrl":"doks.png","caption":"Masters"}]}]}</script><meta name=theme-color content="#fff"><link rel=icon href=favicon.ico sizes=any><link rel=apple-touch-icon sizes=180x180 href=apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=favicon-16x16.png><link rel=manifest crossorigin=use-credentials href=site.webmanifest></head><body class="docs single"><div class=sticky-top><div class=header-bar></div><header class="navbar navbar-expand-lg navbar-light doks-navbar"><nav class="container-xxl flex-wrap flex-lg-nowrap" aria-label="Main navigation"><a class="navbar-brand order-0" href=../../../ aria-label=Protobox>Protobox</a>
<button class="btn btn-link order-0 ms-auto d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasExample aria-controls=offcanvasExample><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-horizontal"><circle cx="12" cy="12" r="1"/><circle cx="19" cy="12" r="1"/><circle cx="5" cy="12" r="1"/></svg></button><div class="offcanvas offcanvas-start d-lg-none" tabindex=-1 id=offcanvasExample aria-labelledby=offcanvasExampleLabel><div class=header-bar></div><div class=offcanvas-header><h5 class=offcanvas-title id=offcanvasExampleLabel>Browse docs</h5><button type=button class=btn-close data-bs-dismiss=offcanvas aria-label=Close></button></div><div class=offcanvas-body><aside class="doks-sidebar mt-n3"><nav id=doks-docs-nav aria-label="Tertiary navigation"><ul class="list-unstyled collapsible-sidebar"><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-c7bc3fddddb62d5b656adc30cea77a55 aria-expanded=false>
Presentation</button><div class=collapse id=section-c7bc3fddddb62d5b656adc30cea77a55><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=../../../docs/presentation/presentation/>Presentation</a></li><li><a class="docs-link rounded" href=../../../docs/presentation/historique/>Historique</a></li><li><a class="docs-link rounded" href=../../../docs/presentation/objectif/>Objectif</a></li><li><a class="docs-link rounded" href=../../../docs/presentation/automatisation/>Automatisation</a></li><li><a class="docs-link rounded" href=../../../docs/presentation/nodespyder/>Nodespyder</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-cba4f4cee5c6a3e6d8be8da68fa1234e aria-expanded=false>
Infrastructure</button><div class=collapse id=section-cba4f4cee5c6a3e6d8be8da68fa1234e><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=../../../docs/infrastructure/architecture/>Architecture</a></li><li><a class="docs-link rounded" href=../../../docs/infrastructure/webservers/>Webservers Pool</a></li><li><a class="docs-link rounded" href=../../../docs/infrastructure/gateways/>Gateways Pool</a></li><li><a class="docs-link rounded" href=../../../docs/infrastructure/databases/>Databases Pool</a></li><li><a class="docs-link rounded" href=../../../docs/infrastructure/search-engine/>Search Engine Pool</a></li><li><a class="docs-link rounded" href=../../../docs/infrastructure/masters/>Masters Pool</a></li><li><a class="docs-link rounded" href=../../../docs/infrastructure/supervisor/>Supervisor Pool</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-e67a3029d043440502a9524d87439e48 aria-expanded=false>
Réseaux</button><div class=collapse id=section-e67a3029d043440502a9524d87439e48><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=../../../docs/r%C3%A9seaux/networking/>Architecture</a></li><li><a class="docs-link rounded" href=../../../docs/r%C3%A9seaux/dhcp/>Server DHCP</a></li><li><a class="docs-link rounded" href=../../../docs/r%C3%A9seaux/proxyserve/>Proxiserver</a></li><li><a class="docs-link rounded" href=../../../docs/r%C3%A9seaux/vip/>FloatingIP</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-30136395f01879792198317c11831ea4 aria-expanded=true>
Kubernetes</button><div class="collapse show" id=section-30136395f01879792198317c11831ea4><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=../../../docs/kubernetes/architecture/>Architecture</a></li><li><a class="docs-link rounded active" href=../../../docs/kubernetes/master/>Masters</a></li><li><a class="docs-link rounded" href=../../../docs/kubernetes/services/>Services</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-5f85afd6861774eed41a0545d4061417 aria-expanded=false>
Factory (CI/CD)</button><div class=collapse id=section-5f85afd6861774eed41a0545d4061417><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=../../../docs/factory/cycle/>Cycle</a></li><li><a class="docs-link rounded" href=../../../docs/factory/ci/>CI (Gitlab CI)</a></li><li><a class="docs-link rounded" href=../../../docs/factory/cd/>CD (GitOps)</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-423e555c5ec3885f2bb5d9d2d6627f63 aria-expanded=false>
Monitoring</button><div class=collapse id=section-423e555c5ec3885f2bb5d9d2d6627f63><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=../../../docs/monitoring/monitor/>Monitor</a></li><li><a class="docs-link rounded" href=../../../docs/monitoring/hardware/>Surveillance matériel</a></li><li><a class="docs-link rounded" href=../../../docs/monitoring/services/>Surveillance applicative</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-c48fb18ab9d562b42911cddcdc0c855f aria-expanded=false>
Authentification</button><div class=collapse id=section-c48fb18ab9d562b42911cddcdc0c855f><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=../../../docs/authentification/oidc/>OIDC</a></li><li><a class="docs-link rounded" href=../../../docs/authentification/pgadmin/>PgAdmin4</a></li><li><a class="docs-link rounded" href=../../../docs/authentification/kubedash/>K8S Dashboard</a></li><li><a class="docs-link rounded" href=../../../docs/authentification/keycloak/>Keycloak</a></li><li><a class="docs-link rounded" href=../../../docs/authentification/kibana/>Kibana</a></li><li><a class="docs-link rounded" href=../../../docs/authentification/prometheus/>Prometheus</a></li><li><a class="docs-link rounded" href=../../../docs/authentification/grafana/>Grafana</a></li></ul></div></li></ul></nav></aside></div></div><button class="btn btn-menu order-2 d-block d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasDoks aria-controls=offcanvasDoks aria-label="Open main menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button><div class="offcanvas offcanvas-end border-0 py-lg-1" tabindex=-1 id=offcanvasDoks data-bs-backdrop=true aria-labelledby=offcanvasDoksLabel><div class="header-bar d-lg-none"></div><div class="offcanvas-header d-lg-none"><h2 class="h5 offcanvas-title ps-2" id=offcanvasDoksLabel><a class=text-dark href=../../../>Protobox</a></h2><button type=button class="btn-close text-reset me-2" data-bs-dismiss=offcanvas aria-label="Close main menu"></button></div><div class="offcanvas-body p-4 p-lg-0"><ul class="nav flex-column flex-lg-row align-items-lg-center mt-2 mt-lg-0 ms-lg-2 me-lg-auto"><li class="nav-item dropdown"><a class="nav-link dropdown-toggle ps-0 py-1" href=# id=navbarDropdownMenuLink role=button data-bs-toggle=dropdown aria-expanded=false>templates
<span class=dropdown-caret><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"/></svg></span></a><ul class="dropdown-menu dropdown-menu-main shadow rounded border-0" aria-labelledby=navbarDropdownMenuLink><li><a class=dropdown-item href=../../../docs/infrastructure/architecture/>Architecture</a></li><li><a class=dropdown-item href=../../../docs/factory/cycle/>Cycle</a></li><li><a class=dropdown-item href=../../../docs/authentification/oidc/>OIDC</a></li><li><a class=dropdown-item href=../../../docs/authentification/pgadmin/>PgAdmin4</a></li><li><a class=dropdown-item href=../../../docs/presentation/presentation/>Presentation</a></li><li><a class=dropdown-item href=../../../docs/factory/ci/>CI (Gitlab CI)</a></li><li><a class=dropdown-item href=../../../docs/presentation/historique/>Historique</a></li><li><a class=dropdown-item href=../../../docs/authentification/kubedash/>K8S Dashboard</a></li><li><a class=dropdown-item href=../../../docs/authentification/keycloak/>Keycloak</a></li><li><a class=dropdown-item href=../../../docs/authentification/kibana/>Kibana</a></li><li><a class="dropdown-item active" href=../../../docs/kubernetes/master/ aria-current=true>Masters</a></li><li><a class=dropdown-item href=../../../docs/authentification/prometheus/>Prometheus</a></li><li><a class=dropdown-item href=../../../docs/r%C3%A9seaux/dhcp/>Server DHCP</a></li><li><a class=dropdown-item href=../../../docs/monitoring/hardware/>Surveillance matériel</a></li><li><a class=dropdown-item href=../../../docs/factory/cd/>CD (GitOps)</a></li><li><a class=dropdown-item href=../../../docs/authentification/grafana/>Grafana</a></li><li><a class=dropdown-item href=../../../docs/presentation/objectif/>Objectif</a></li><li><a class=dropdown-item href=../../../docs/kubernetes/services/>Services</a></li><li><a class=dropdown-item href=../../../docs/monitoring/services/>Surveillance applicative</a></li><li><a class=dropdown-item href=../../../docs/infrastructure/webservers/>Webservers Pool</a></li><li><a class=dropdown-item href=../../../docs/presentation/automatisation/>Automatisation</a></li><li><a class=dropdown-item href=../../../docs/r%C3%A9seaux/vip/>FloatingIP</a></li><li><a class=dropdown-item href=../../../docs/infrastructure/gateways/>Gateways Pool</a></li><li><a class=dropdown-item href=../../../docs/infrastructure/databases/>Databases Pool</a></li><li><a class=dropdown-item href=../../../docs/presentation/nodespyder/>Nodespyder</a></li><li><a class=dropdown-item href=../../../docs/infrastructure/search-engine/>Search Engine Pool</a></li><li><a class=dropdown-item href=../../../docs/infrastructure/masters/>Masters Pool</a></li><li><a class=dropdown-item href=../../../docs/infrastructure/supervisor/>Supervisor Pool</a></li></ul></li></ul><hr class="text-black-50 my-4 d-lg-none"><form class="doks-search position-relative flex-grow-1 ms-lg-auto me-lg-2"><input id=search class="form-control is-search" type=search placeholder="Search docs..." aria-label="Search docs..." autocomplete=off><div id=suggestions class="shadow bg-white rounded d-none"></div></form><hr class="text-black-50 my-4 d-lg-none"><ul class="nav flex-column flex-lg-row"><li class=nav-item><a class="nav-link social-link" href=../../../https:/github.com/h-enk/doks><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><small class="ms-2 d-lg-none">GitHub</small></a></li></ul></div></div></nav></header></div><div class=container-xxl><aside class=doks-sidebar><nav id=doks-docs-nav class="collapse d-lg-none" aria-label="Tertiary navigation"><ul class="list-unstyled collapsible-sidebar"><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-c7bc3fddddb62d5b656adc30cea77a55 aria-expanded=false>
Presentation</button><div class=collapse id=section-c7bc3fddddb62d5b656adc30cea77a55><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=../../../docs/presentation/presentation/>Presentation</a></li><li><a class="docs-link rounded" href=../../../docs/presentation/historique/>Historique</a></li><li><a class="docs-link rounded" href=../../../docs/presentation/objectif/>Objectif</a></li><li><a class="docs-link rounded" href=../../../docs/presentation/automatisation/>Automatisation</a></li><li><a class="docs-link rounded" href=../../../docs/presentation/nodespyder/>Nodespyder</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-cba4f4cee5c6a3e6d8be8da68fa1234e aria-expanded=false>
Infrastructure</button><div class=collapse id=section-cba4f4cee5c6a3e6d8be8da68fa1234e><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=../../../docs/infrastructure/architecture/>Architecture</a></li><li><a class="docs-link rounded" href=../../../docs/infrastructure/webservers/>Webservers Pool</a></li><li><a class="docs-link rounded" href=../../../docs/infrastructure/gateways/>Gateways Pool</a></li><li><a class="docs-link rounded" href=../../../docs/infrastructure/databases/>Databases Pool</a></li><li><a class="docs-link rounded" href=../../../docs/infrastructure/search-engine/>Search Engine Pool</a></li><li><a class="docs-link rounded" href=../../../docs/infrastructure/masters/>Masters Pool</a></li><li><a class="docs-link rounded" href=../../../docs/infrastructure/supervisor/>Supervisor Pool</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-e67a3029d043440502a9524d87439e48 aria-expanded=false>
Réseaux</button><div class=collapse id=section-e67a3029d043440502a9524d87439e48><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=../../../docs/r%C3%A9seaux/networking/>Architecture</a></li><li><a class="docs-link rounded" href=../../../docs/r%C3%A9seaux/dhcp/>Server DHCP</a></li><li><a class="docs-link rounded" href=../../../docs/r%C3%A9seaux/proxyserve/>Proxiserver</a></li><li><a class="docs-link rounded" href=../../../docs/r%C3%A9seaux/vip/>FloatingIP</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-30136395f01879792198317c11831ea4 aria-expanded=true>
Kubernetes</button><div class="collapse show" id=section-30136395f01879792198317c11831ea4><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=../../../docs/kubernetes/architecture/>Architecture</a></li><li><a class="docs-link rounded active" href=../../../docs/kubernetes/master/>Masters</a></li><li><a class="docs-link rounded" href=../../../docs/kubernetes/services/>Services</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-5f85afd6861774eed41a0545d4061417 aria-expanded=false>
Factory (CI/CD)</button><div class=collapse id=section-5f85afd6861774eed41a0545d4061417><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=../../../docs/factory/cycle/>Cycle</a></li><li><a class="docs-link rounded" href=../../../docs/factory/ci/>CI (Gitlab CI)</a></li><li><a class="docs-link rounded" href=../../../docs/factory/cd/>CD (GitOps)</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-423e555c5ec3885f2bb5d9d2d6627f63 aria-expanded=false>
Monitoring</button><div class=collapse id=section-423e555c5ec3885f2bb5d9d2d6627f63><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=../../../docs/monitoring/monitor/>Monitor</a></li><li><a class="docs-link rounded" href=../../../docs/monitoring/hardware/>Surveillance matériel</a></li><li><a class="docs-link rounded" href=../../../docs/monitoring/services/>Surveillance applicative</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-c48fb18ab9d562b42911cddcdc0c855f aria-expanded=false>
Authentification</button><div class=collapse id=section-c48fb18ab9d562b42911cddcdc0c855f><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=../../../docs/authentification/oidc/>OIDC</a></li><li><a class="docs-link rounded" href=../../../docs/authentification/pgadmin/>PgAdmin4</a></li><li><a class="docs-link rounded" href=../../../docs/authentification/kubedash/>K8S Dashboard</a></li><li><a class="docs-link rounded" href=../../../docs/authentification/keycloak/>Keycloak</a></li><li><a class="docs-link rounded" href=../../../docs/authentification/kibana/>Kibana</a></li><li><a class="docs-link rounded" href=../../../docs/authentification/prometheus/>Prometheus</a></li><li><a class="docs-link rounded" href=../../../docs/authentification/grafana/>Grafana</a></li></ul></div></li></ul></nav></aside></div><div class="wrap container-xxl" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar d-none d-lg-block"><nav class=docs-links aria-label="Main navigation"><ul class="list-unstyled collapsible-sidebar"><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-c7bc3fddddb62d5b656adc30cea77a55 aria-expanded=false>
Presentation</button><div class=collapse id=section-c7bc3fddddb62d5b656adc30cea77a55><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=../../../docs/presentation/presentation/>Presentation</a></li><li><a class="docs-link rounded" href=../../../docs/presentation/historique/>Historique</a></li><li><a class="docs-link rounded" href=../../../docs/presentation/objectif/>Objectif</a></li><li><a class="docs-link rounded" href=../../../docs/presentation/automatisation/>Automatisation</a></li><li><a class="docs-link rounded" href=../../../docs/presentation/nodespyder/>Nodespyder</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-cba4f4cee5c6a3e6d8be8da68fa1234e aria-expanded=false>
Infrastructure</button><div class=collapse id=section-cba4f4cee5c6a3e6d8be8da68fa1234e><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=../../../docs/infrastructure/architecture/>Architecture</a></li><li><a class="docs-link rounded" href=../../../docs/infrastructure/webservers/>Webservers Pool</a></li><li><a class="docs-link rounded" href=../../../docs/infrastructure/gateways/>Gateways Pool</a></li><li><a class="docs-link rounded" href=../../../docs/infrastructure/databases/>Databases Pool</a></li><li><a class="docs-link rounded" href=../../../docs/infrastructure/search-engine/>Search Engine Pool</a></li><li><a class="docs-link rounded" href=../../../docs/infrastructure/masters/>Masters Pool</a></li><li><a class="docs-link rounded" href=../../../docs/infrastructure/supervisor/>Supervisor Pool</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-e67a3029d043440502a9524d87439e48 aria-expanded=false>
Réseaux</button><div class=collapse id=section-e67a3029d043440502a9524d87439e48><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=../../../docs/r%C3%A9seaux/networking/>Architecture</a></li><li><a class="docs-link rounded" href=../../../docs/r%C3%A9seaux/dhcp/>Server DHCP</a></li><li><a class="docs-link rounded" href=../../../docs/r%C3%A9seaux/proxyserve/>Proxiserver</a></li><li><a class="docs-link rounded" href=../../../docs/r%C3%A9seaux/vip/>FloatingIP</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-30136395f01879792198317c11831ea4 aria-expanded=true>
Kubernetes</button><div class="collapse show" id=section-30136395f01879792198317c11831ea4><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=../../../docs/kubernetes/architecture/>Architecture</a></li><li><a class="docs-link rounded active" href=../../../docs/kubernetes/master/>Masters</a></li><li><a class="docs-link rounded" href=../../../docs/kubernetes/services/>Services</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-5f85afd6861774eed41a0545d4061417 aria-expanded=false>
Factory (CI/CD)</button><div class=collapse id=section-5f85afd6861774eed41a0545d4061417><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=../../../docs/factory/cycle/>Cycle</a></li><li><a class="docs-link rounded" href=../../../docs/factory/ci/>CI (Gitlab CI)</a></li><li><a class="docs-link rounded" href=../../../docs/factory/cd/>CD (GitOps)</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-423e555c5ec3885f2bb5d9d2d6627f63 aria-expanded=false>
Monitoring</button><div class=collapse id=section-423e555c5ec3885f2bb5d9d2d6627f63><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=../../../docs/monitoring/monitor/>Monitor</a></li><li><a class="docs-link rounded" href=../../../docs/monitoring/hardware/>Surveillance matériel</a></li><li><a class="docs-link rounded" href=../../../docs/monitoring/services/>Surveillance applicative</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-c48fb18ab9d562b42911cddcdc0c855f aria-expanded=false>
Authentification</button><div class=collapse id=section-c48fb18ab9d562b42911cddcdc0c855f><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=../../../docs/authentification/oidc/>OIDC</a></li><li><a class="docs-link rounded" href=../../../docs/authentification/pgadmin/>PgAdmin4</a></li><li><a class="docs-link rounded" href=../../../docs/authentification/kubedash/>K8S Dashboard</a></li><li><a class="docs-link rounded" href=../../../docs/authentification/keycloak/>Keycloak</a></li><li><a class="docs-link rounded" href=../../../docs/authentification/kibana/>Kibana</a></li><li><a class="docs-link rounded" href=../../../docs/authentification/prometheus/>Prometheus</a></li><li><a class="docs-link rounded" href=../../../docs/authentification/grafana/>Grafana</a></li></ul></div></li></ul></nav></div><nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=d-xl-none><button class="btn btn-outline-primary btn-sm doks-toc-toggle collapsed" type=button data-bs-toggle=collapse data-bs-target=#onThisPage aria-controls=doks-docs-nav aria-expanded=false aria-label="Toggle On this page navigation">
<span>On this page</span>
<span><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" class="doks doks-expand" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Expand</title><polyline points="7 13 12 18 17 13"/><polyline points="7 6 12 11 17 6"/></svg><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" class="doks doks-collapse" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Collapse</title><polyline points="17 11 12 6 7 11"/><polyline points="17 18 12 13 7 18"/></svg></span></button><div class=collapse id=onThisPage><div class="card card-body mt-3 py-1"><div class=page-links><nav id=TableOfContents><ul><li><a href=#1-présentation>1. Présentation</a></li><li><a href=#2-composants-du-control-plane>2. Composants du Control Plane</a><ul><li><a href=#span-stylecolororange--kube-apiserverspan><span style=color:orange>- kube-apiserver</span></a></li><li><a href=#span-stylecolororange--etcdspan><span style=color:orange>- etcd</span></a></li><li><a href=#span-stylecolororange--kube-schedulerspan><span style=color:orange>- kube-scheduler</span></a></li><li><a href=#span-stylecolororange--kube-controller-managerspan><span style=color:orange>- kube-controller-manager</span></a></li></ul></li><li><a href=#3-architecture>3. Architecture</a></li><li><a href=#2-roles>2. Roles</a></li><li><a href=#3-networking>3. Networking</a></li><li><a href=#5-haute-disponibilité>5. Haute disponibilité</a><ul><li><a href=#51-principe-de-quorum>5.1. Principe de Quorum</a></li><li><a href=#52-cluster-etcd>5.2. Cluster ETCD</a></li><li><a href=#53-rapport-etcdcontrol-plane>5.3 Rapport ETCD/Control Plane</a></li><li><a href=#331-stacked-etcd-cluster>3.3.1. Stacked Etcd Cluster</a></li><li><a href=#condition-de-disponibilité>Condition de disponibilité</a></li><li><a href=#332-external-etcd-cluster>3.3.2. External Etcd Cluster</a></li><li><a href=#333-architecture-etcd-de-linfrastructure>3.3.3. architecture etcd de l&rsquo;infrastructure</a></li><li><a href=#4-volumes>4. Volumes</a></li></ul></li><li><a href=#9-bilan>9. Bilan</a></li></ul></nav></div></div></div></div><div class="page-links d-none d-xl-block"><h3>On this page</h3><nav id=TableOfContents><ul><li><a href=#1-présentation>1. Présentation</a></li><li><a href=#2-composants-du-control-plane>2. Composants du Control Plane</a><ul><li><a href=#span-stylecolororange--kube-apiserverspan><span style=color:orange>- kube-apiserver</span></a></li><li><a href=#span-stylecolororange--etcdspan><span style=color:orange>- etcd</span></a></li><li><a href=#span-stylecolororange--kube-schedulerspan><span style=color:orange>- kube-scheduler</span></a></li><li><a href=#span-stylecolororange--kube-controller-managerspan><span style=color:orange>- kube-controller-manager</span></a></li></ul></li><li><a href=#3-architecture>3. Architecture</a></li><li><a href=#2-roles>2. Roles</a></li><li><a href=#3-networking>3. Networking</a></li><li><a href=#5-haute-disponibilité>5. Haute disponibilité</a><ul><li><a href=#51-principe-de-quorum>5.1. Principe de Quorum</a></li><li><a href=#52-cluster-etcd>5.2. Cluster ETCD</a></li><li><a href=#53-rapport-etcdcontrol-plane>5.3 Rapport ETCD/Control Plane</a></li><li><a href=#331-stacked-etcd-cluster>3.3.1. Stacked Etcd Cluster</a></li><li><a href=#condition-de-disponibilité>Condition de disponibilité</a></li><li><a href=#332-external-etcd-cluster>3.3.2. External Etcd Cluster</a></li><li><a href=#333-architecture-etcd-de-linfrastructure>3.3.3. architecture etcd de l&rsquo;infrastructure</a></li><li><a href=#4-volumes>4. Volumes</a></li></ul></li><li><a href=#9-bilan>9. Bilan</a></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-9 mx-xl-auto"><h1>Masters</h1><p class=lead></p><nav class=d-xl-none aria-label="Quaternary navigation"><div class=d-xl-none><button class="btn btn-outline-primary btn-sm doks-toc-toggle collapsed" type=button data-bs-toggle=collapse data-bs-target=#onThisPage aria-controls=doks-docs-nav aria-expanded=false aria-label="Toggle On this page navigation">
<span>On this page</span>
<span><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" class="doks doks-expand" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Expand</title><polyline points="7 13 12 18 17 13"/><polyline points="7 6 12 11 17 6"/></svg><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" class="doks doks-collapse" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Collapse</title><polyline points="17 11 12 6 7 11"/><polyline points="17 18 12 13 7 18"/></svg></span></button><div class=collapse id=onThisPage><div class="card card-body mt-3 py-1"><div class=page-links><nav id=TableOfContents><ul><li><a href=#1-présentation>1. Présentation</a></li><li><a href=#2-composants-du-control-plane>2. Composants du Control Plane</a><ul><li><a href=#span-stylecolororange--kube-apiserverspan><span style=color:orange>- kube-apiserver</span></a></li><li><a href=#span-stylecolororange--etcdspan><span style=color:orange>- etcd</span></a></li><li><a href=#span-stylecolororange--kube-schedulerspan><span style=color:orange>- kube-scheduler</span></a></li><li><a href=#span-stylecolororange--kube-controller-managerspan><span style=color:orange>- kube-controller-manager</span></a></li></ul></li><li><a href=#3-architecture>3. Architecture</a></li><li><a href=#2-roles>2. Roles</a></li><li><a href=#3-networking>3. Networking</a></li><li><a href=#5-haute-disponibilité>5. Haute disponibilité</a><ul><li><a href=#51-principe-de-quorum>5.1. Principe de Quorum</a></li><li><a href=#52-cluster-etcd>5.2. Cluster ETCD</a></li><li><a href=#53-rapport-etcdcontrol-plane>5.3 Rapport ETCD/Control Plane</a></li><li><a href=#331-stacked-etcd-cluster>3.3.1. Stacked Etcd Cluster</a></li><li><a href=#condition-de-disponibilité>Condition de disponibilité</a></li><li><a href=#332-external-etcd-cluster>3.3.2. External Etcd Cluster</a></li><li><a href=#333-architecture-etcd-de-linfrastructure>3.3.3. architecture etcd de l&rsquo;infrastructure</a></li><li><a href=#4-volumes>4. Volumes</a></li></ul></li><li><a href=#9-bilan>9. Bilan</a></li></ul></nav></div></div></div></div><div class="page-links d-none d-xl-block"><h3>On this page</h3><nav id=TableOfContents><ul><li><a href=#1-présentation>1. Présentation</a></li><li><a href=#2-composants-du-control-plane>2. Composants du Control Plane</a><ul><li><a href=#span-stylecolororange--kube-apiserverspan><span style=color:orange>- kube-apiserver</span></a></li><li><a href=#span-stylecolororange--etcdspan><span style=color:orange>- etcd</span></a></li><li><a href=#span-stylecolororange--kube-schedulerspan><span style=color:orange>- kube-scheduler</span></a></li><li><a href=#span-stylecolororange--kube-controller-managerspan><span style=color:orange>- kube-controller-manager</span></a></li></ul></li><li><a href=#3-architecture>3. Architecture</a></li><li><a href=#2-roles>2. Roles</a></li><li><a href=#3-networking>3. Networking</a></li><li><a href=#5-haute-disponibilité>5. Haute disponibilité</a><ul><li><a href=#51-principe-de-quorum>5.1. Principe de Quorum</a></li><li><a href=#52-cluster-etcd>5.2. Cluster ETCD</a></li><li><a href=#53-rapport-etcdcontrol-plane>5.3 Rapport ETCD/Control Plane</a></li><li><a href=#331-stacked-etcd-cluster>3.3.1. Stacked Etcd Cluster</a></li><li><a href=#condition-de-disponibilité>Condition de disponibilité</a></li><li><a href=#332-external-etcd-cluster>3.3.2. External Etcd Cluster</a></li><li><a href=#333-architecture-etcd-de-linfrastructure>3.3.3. architecture etcd de l&rsquo;infrastructure</a></li><li><a href=#4-volumes>4. Volumes</a></li></ul></li><li><a href=#9-bilan>9. Bilan</a></li></ul></nav></div></nav><h2 id=1-présentation>1. Présentation <a href=#1-pr%c3%a9sentation class=anchor aria-hidden=true>#</a></h2><p>Les masters sont répliqués pour garantir la haute disponibilité du cluster.
Dans notre infrastructure, on dispose de 3 masters. Ces derniers sont le socle du <strong>Control Plane</strong></p><h2 id=2-composants-du-control-plane>2. Composants du Control Plane <a href=#2-composants-du-control-plane class=anchor aria-hidden=true>#</a></h2><p>Ref: <a href=https://kubernetes.io/fr/docs/concepts/overview/components/ target=blank>kubernetes documentation</a></p><h3 id=span-stylecolororange--kube-apiserverspan><span style=color:orange>- kube-apiserver</span> <a href=#span-stylecolororange--kube-apiserverspan class=anchor aria-hidden=true>#</a></h3><p>Composant sur le master qui expose l&rsquo;API Kubernetes. Il s&rsquo;agit du front-end pour le plan de contrôle Kubernetes.</p><p>Il est conçu pour une mise à l&rsquo;échelle horizontale, ce qui veut dire qu&rsquo;il met à l&rsquo;échelle en déployant des instances supplémentaires. Voir Construire des Clusters en Haute Disponibilité.</p><h3 id=span-stylecolororange--etcdspan><span style=color:orange>- etcd</span> <a href=#span-stylecolororange--etcdspan class=anchor aria-hidden=true>#</a></h3><p>Base de données clé-valeur consistante et hautement disponible utilisée comme mémoire de sauvegarde pour toutes les données du cluster.</p><p>Si votre cluster Kubernetes utilise etcd comme mémoire de sauvegarde, assurez-vous d&rsquo;avoir un plan de back up pour ces données.</p><p>Vous pouvez trouver plus d&rsquo;informations à propos d&rsquo;etcd dans la documentation officielle.</p><h3 id=span-stylecolororange--kube-schedulerspan><span style=color:orange>- kube-scheduler</span> <a href=#span-stylecolororange--kube-schedulerspan class=anchor aria-hidden=true>#</a></h3><p>Composant sur le master qui surveille les pods nouvellement créés qui ne sont pas assignés à un nœud et sélectionne un nœud sur lequel ils vont s&rsquo;exécuter.</p><p>Les facteurs pris en compte pour les décisions de planification (scheduling) comprennent les exigences individuelles et collectives en ressources, les contraintes matérielles/logicielles/politiques, les spécifications d&rsquo;affinité et d&rsquo;anti-affinité, la localité des données, les interférences entre charges de travail et les dates limites.</p><h3 id=span-stylecolororange--kube-controller-managerspan><span style=color:orange>- kube-controller-manager</span> <a href=#span-stylecolororange--kube-controller-managerspan class=anchor aria-hidden=true>#</a></h3><p>Composant du master qui exécute les contrôleurs.</p><p>Logiquement, chaque contrôleur est un processus à part mais, pour réduire la complexité, les contrôleurs sont tous compilés dans un seul binaire et s&rsquo;exécutent dans un seul processus.</p><p>Ces contrôleurs incluent :</p><p>Node Controller : Responsable de détecter et apporter une réponse lorsqu&rsquo;un nœud tombe en panne.
Replication Controller : Responsable de maintenir le bon nombre de pods pour chaque objet ReplicationController dans le système.
Endpoints Controller : Remplit les objets Endpoints (c&rsquo;est-à-dire joint les Services et Pods).
Service Account & Token Controllers : Créent des comptes par défaut et des jetons d&rsquo;accès à l&rsquo;API pour les nouveaux namespaces.
cloud-controller-manager
Le cloud-controller-manager exécute les contrôleurs qui interagissent avec les fournisseurs cloud sous-jacents. Le binaire du cloud-controller-manager est une fonctionnalité alpha introduite dans la version 1.6 de Kubernetes.</p><p>Le cloud-controller-manager exécute seulement les boucles spécifiques des fournisseurs cloud. Vous devez désactiver ces boucles de contrôleurs dans le kube-controller-manager. Vous pouvez désactiver les boucles de contrôleurs en définissant la valeur du flag &ndash;cloud-provider à external lors du démarrage du kube-controller-manager.</p><p>Le cloud-controller-manager permet au code du fournisseur cloud et au code de Kubernetes d&rsquo;évoluer indépendamment l&rsquo;un de l&rsquo;autre. Dans des versions antérieures, le code de base de Kubernetes dépendait du code spécifique du fournisseur cloud pour la fonctionnalité. Dans des versions ultérieures, le code spécifique des fournisseurs cloud devrait être maintenu par les fournisseurs cloud eux-mêmes et lié au cloud-controller-manager lors de l&rsquo;exécution de Kubernetes.</p><p>Les contrôleurs suivants ont des dépendances vers des fournisseurs cloud :</p><p>Node Controller : Pour vérifier le fournisseur de cloud afin de déterminer si un nœud a été supprimé dans le cloud après avoir cessé de répondre
Route Controller : Pour mettre en place des routes dans l&rsquo;infrastructure cloud sous-jacente
Service Controller : Pour créer, mettre à jour et supprimer les load balancers des fournisseurs cloud
Volume Controller : Pour créer, attacher et monter des Volumes, et interagir avec le fournisseur cloud pour orchestrer les volumes.</p><h2 id=3-architecture>3. Architecture <a href=#3-architecture class=anchor aria-hidden=true>#</a></h2><p><img class="img-fluid lazyload blur-up" srcset="../../../images/kube-masters-archi_huac2cd2ff00dc4de0fce991ef59b88e49_79244_9ae7679ed5f63f7e881856ad1ca2d2b2.webp 480w, ../../../images/kube-masters-archi_huac2cd2ff00dc4de0fce991ef59b88e49_79244_d85d9790a216cf4ea3ca6526a868e8d8.webp 720w, ../../../images/kube-masters-archi_huac2cd2ff00dc4de0fce991ef59b88e49_79244_33686cc020abfe7df12fc24b6f07341a.webp 1080w, ../../../images/kube-masters-archi_huac2cd2ff00dc4de0fce991ef59b88e49_79244_bdf680db2585c2dc071d1d42a2857479.webp 1280w, ../../../images/kube-masters-archi_huac2cd2ff00dc4de0fce991ef59b88e49_79244_1382x0_resize_q75_h2_box_3.webp 1382w" sizes=80vw src=../../../images/kube-masters-archi_huac2cd2ff00dc4de0fce991ef59b88e49_79244_1382x0_resize_q75_h2_box_3.webp alt=infra width=1382 height=1102></p><h2 id=2-roles>2. Roles <a href=#2-roles class=anchor aria-hidden=true>#</a></h2><ul><li><span style=color:orange;font-weight:700>master-pool</span><br>Ce groupe assure le bon fonctionnement du control plane</li><li><span style=color:orange;font-weight:700>supervisor</span><br>Cette machine interagit avec l&rsquo;apiserver pour commander le control plane.
Les manifests destinés au déploiements dans ce host.</li></ul><h2 id=3-networking>3. Networking <a href=#3-networking class=anchor aria-hidden=true>#</a></h2><p>Interface:</p><ul><li><span style=color:orange;font-weight:700>Kubernetes CNI</span></li></ul><h2 id=5-haute-disponibilité>5. Haute disponibilité <a href=#5-haute-disponibilit%c3%a9 class=anchor aria-hidden=true>#</a></h2><h3 id=51-principe-de-quorum>5.1. Principe de Quorum <a href=#51-principe-de-quorum class=anchor aria-hidden=true>#</a></h3><p>Ref: <a href=https://learn.microsoft.com/fr-fr/azure-stack/hci/concepts/quorum target=blank>Microsoft Learn</a><br></p><p>Le quorum est conçu pour empêcher les scénarios split-brain qui peuvent se produire lorsqu’il existe une partition au sein du réseau et que les sous-ensembles de nœuds ne peuvent pas communiquer entre eux. Cela peut amener les deux sous-ensembles de nœuds à tenter de s’approprier la charge de travail et à écrire sur le même disque, ce qui peut entraîner de nombreux problèmes. Toutefois, un tel scénario peut être évité grâce au concept de quorum du clustering de basculement, qui force l’exécution d’un seul de ces groupes de nœuds. De cette façon, un seul de ces groupes reste en ligne.</p><p>Le quorum détermine le nombre d’échecs que le cluster peut supporter tout en restant en ligne. Le quorum est conçu pour gérer les problèmes de communication entre les sous-ensembles de nœuds du cluster. Il empêche plusieurs serveurs d’héberger simultanément un groupe de ressources et d’écrire sur un même disque en même temps. Grâce à ce concept de quorum, le cluster force le service de cluster à s’arrêter dans l’un des sous-ensembles de nœuds de sorte qu’il n’y ait qu’un seul véritable propriétaire pour chaque groupe de ressources. Une fois que les nœuds qui ont été arrêtés peuvent de nouveau communiquer avec le groupe de nœuds principal, ils rejoignent automatiquement le cluster et démarrent leur service de cluster.</p><p><img class="img-fluid lazyload blur-up" srcset="../../../images/quorum_hu9c0aad21dac2b0b1fa8ace7247814b3e_88554_151c186f395202e50b87451dac4d8f6f.webp 480w, ../../../images/quorum_hu9c0aad21dac2b0b1fa8ace7247814b3e_88554_5a5360a9bf9723459bf3537e5fd5b156.webp 720w, ../../../images/quorum_hu9c0aad21dac2b0b1fa8ace7247814b3e_88554_d3199cc73d4866d6d3fe3ddb17938719.webp 1080w, ../../../images/quorum_hu9c0aad21dac2b0b1fa8ace7247814b3e_88554_1258x0_resize_q75_h2_box_3.webp 1258w" sizes=80vw src=../../../images/quorum_hu9c0aad21dac2b0b1fa8ace7247814b3e_88554_1258x0_resize_q75_h2_box_3.webp alt=infra width=1258 height=740></p><p><strong>Recommandations relatives au quorum de cluster</strong>a<br>Si vous avez deux nœuds, il est obligatoire de disposer d’un témoin.
Si vous disposez de trois ou quatre nœuds, le témoin est fortement recommandé.
Si vous avez cinq nœuds ou plus, un témoin n’est pas nécessaire et ne fournit pas de résilience supplémentaire.
Si vous avez accès à Internet, utilisez un témoin de cloud.
Si vous êtes dans un environnement informatique qui comprend d’autres machines et partages de fichiers, utilisez un témoin de partage de fichiers.</p><h3 id=52-cluster-etcd>5.2. Cluster ETCD <a href=#52-cluster-etcd class=anchor aria-hidden=true>#</a></h3><p>ETCD est la base de donnée par défaut de kubernetes. C&rsquo;est une base de données key/value conçu pour stocker des paramètres de configuration.</p><p>ETCD fonctionne en cluster dont la haute disponibilité se base sur <span style=color:orange;font-weight:700>Quorum</span></p><p><img class="img-fluid lazyload blur-up" srcset="../../../images/etcd-cluster_hu6ca2fc72a9c75600efc8656d1dc373e2_65319_0cf11ac5a8f2e8d10a37c691a9307633.webp 480w, ../../../images/etcd-cluster_hu6ca2fc72a9c75600efc8656d1dc373e2_65319_c277805398ff9018a61d3bc22c58a883.webp 720w, ../../../images/etcd-cluster_hu6ca2fc72a9c75600efc8656d1dc373e2_65319_4662e79f3af606873e90493c913da0ec.webp 1080w, ../../../images/etcd-cluster_hu6ca2fc72a9c75600efc8656d1dc373e2_65319_1159x0_resize_q75_h2_box_3.webp 1159w" sizes=80vw src=../../../images/etcd-cluster_hu6ca2fc72a9c75600efc8656d1dc373e2_65319_1159x0_resize_q75_h2_box_3.webp alt=infra width=1159 height=804></p><p>La haute disponibilitê de kubernetes dépend non seulement du nombre de réplica du control plane mais aussi est fortement conditionnée par la haute disponibilité de ETCD</p><h3 id=53-rapport-etcdcontrol-plane>5.3 Rapport ETCD/Control Plane <a href=#53-rapport-etcdcontrol-plane class=anchor aria-hidden=true>#</a></h3><p>Kubernetes élabore 2 types d&rsquo;architecture de la relation ETCD/Control Plane:</p><h3 id=331-stacked-etcd-cluster>3.3.1. Stacked Etcd Cluster <a href=#331-stacked-etcd-cluster class=anchor aria-hidden=true>#</a></h3><p>Sur ce type d&rsquo;architecture chaque master embarque sa propre base de données. Ainsi le nombre de masters est strictement égal aux instance etcd. Dans ce cas de figure, le principe de <span style=color:orange;font-weight:700>quorum</span> s&rsquo;applique aux nombres de masters</p><p><img class="img-fluid lazyload blur-up" srcset="../../../images/stacked-etcd-cluster_huae0238575e1218392d93d456e58908a8_91915_2be666b3f4ae0e189b1cd6207488a753.webp 480w, ../../../images/stacked-etcd-cluster_huae0238575e1218392d93d456e58908a8_91915_0399ba8c189eb2360309a7a7863938c2.webp 720w, ../../../images/stacked-etcd-cluster_huae0238575e1218392d93d456e58908a8_91915_94b2654950089c4c4b33a022728ce717.webp 1080w, ../../../images/stacked-etcd-cluster_huae0238575e1218392d93d456e58908a8_91915_00a5e93c7023f8e0b41495d30ae2a74c.webp 1280w, ../../../images/stacked-etcd-cluster_huae0238575e1218392d93d456e58908a8_91915_1382x0_resize_q75_h2_box_3.webp 1382w" sizes=80vw src=../../../images/stacked-etcd-cluster_huae0238575e1218392d93d456e58908a8_91915_1382x0_resize_q75_h2_box_3.webp alt=stacked-etcd-cluster width=1382 height=1295></p><h3 id=condition-de-disponibilité>Condition de disponibilité <a href=#condition-de-disponibilit%c3%a9 class=anchor aria-hidden=true>#</a></h3><p>Pour 3 noeuds la majorité de quorum est 2. En effet c&rsquo;est le nombre au dessous duquel le cluster est hors service.</p><h4 id=table-de-quorum-pour-3-noeuds>Table de quorum pour 3 noeuds <a href=#table-de-quorum-pour-3-noeuds class=anchor aria-hidden=true>#</a></h4><table><thead><tr><th>Noeud en service</th><th>Noeud hors service</th><th>Majorité</th><th>Disponibilité</th></tr></thead><tbody><tr><td><strong>3</strong></td><td><strong>0</strong></td><td>3</td><td><span style=color:#59ae01;font-weight:700>UP</span></td></tr><tr><td><strong>2</strong></td><td><strong>1</strong></td><td>2</td><td><span style=color:#59ae01;font-weight:700>UP</span></td></tr><tr><td><strong>1</strong></td><td><strong>2</strong></td><td>1</td><td><span style=color:red;font-weight:700>Down</span></td></tr></tbody></table><h3 id=332-external-etcd-cluster>3.3.2. External Etcd Cluster <a href=#332-external-etcd-cluster class=anchor aria-hidden=true>#</a></h3><p>L&rsquo;externalisation des bases etcd permet d&rsquo;extendre le quota de la majorité (le nombre d&rsquo;instance en service) de <span style=color:orange;font-weight:700>quorum</span>. Cette architecture a l&rsquo;avantage d&rsquo;agir sur la haute disponibilité sans ajouter des masters supplémentaires. Ce model ajoute une couche de sécurité en même temps la maintenance est plus souple.</p><p>Exemple: ETCD avec 3 instances</p><p><img class="img-fluid lazyload blur-up" srcset="../../../images/external-etcd-cluster_hu4959c0cd36529f975d3fd7082b5a04c1_90237_3546804857ee22062ec3ff90e7eb8d5e.webp 480w, ../../../images/external-etcd-cluster_hu4959c0cd36529f975d3fd7082b5a04c1_90237_00b9077335b26244d173ece4853c7498.webp 720w, ../../../images/external-etcd-cluster_hu4959c0cd36529f975d3fd7082b5a04c1_90237_388a3352850f9030ed27716aed29146f.webp 1080w, ../../../images/external-etcd-cluster_hu4959c0cd36529f975d3fd7082b5a04c1_90237_2dd943d53e17fd576ca6327d3bb42ce6.webp 1280w, ../../../images/external-etcd-cluster_hu4959c0cd36529f975d3fd7082b5a04c1_90237_1382x0_resize_q75_h2_box_3.webp 1382w" sizes=80vw src=../../../images/external-etcd-cluster_hu4959c0cd36529f975d3fd7082b5a04c1_90237_1382x0_resize_q75_h2_box_3.webp alt=external-etcd-cluster width=1382 height=1226></p><p>Exemple: ETCD avec 6 instances</p><p><img class="img-fluid lazyload blur-up" srcset="../../../images/external-etcd-cluster-6_hub272242692efc4af6c7af05aed1bc4d3_106914_f2317edb198c4c81eaad486913aadf2b.webp 480w, ../../../images/external-etcd-cluster-6_hub272242692efc4af6c7af05aed1bc4d3_106914_19b04297100c45c5f2f0ba11cd33f7d3.webp 720w, ../../../images/external-etcd-cluster-6_hub272242692efc4af6c7af05aed1bc4d3_106914_0ef0f005b2c113153fb8c852864dbffc.webp 1080w, ../../../images/external-etcd-cluster-6_hub272242692efc4af6c7af05aed1bc4d3_106914_fd973937056386b05b8378028ea66a19.webp 1280w, ../../../images/external-etcd-cluster-6_hub272242692efc4af6c7af05aed1bc4d3_106914_1382x0_resize_q75_h2_box_3.webp 1382w" sizes=80vw src=../../../images/external-etcd-cluster-6_hub272242692efc4af6c7af05aed1bc4d3_106914_1382x0_resize_q75_h2_box_3.webp alt=external-etcd-cluster width=1382 height=1539></p><h4 id=table-de-quorum-pour-6-noeuds>Table de quorum pour 6 noeuds <a href=#table-de-quorum-pour-6-noeuds class=anchor aria-hidden=true>#</a></h4><table><thead><tr><th>Noeud en service</th><th>Noeud hors service</th><th>Majorité</th><th>Disponibilité</th></tr></thead><tbody><tr><td><strong>6</strong></td><td><strong>0</strong></td><td>6</td><td><span style=color:#59ae01;font-weight:700>UP</span></td></tr><tr><td><strong>5</strong></td><td><strong>1</strong></td><td>5</td><td><span style=color:#59ae01;font-weight:700>UP</span></td></tr><tr><td><strong>4</strong></td><td><strong>2</strong></td><td>4</td><td><span style=color:#59ae01;font-weight:700>UP</span></td></tr><tr><td><strong>3</strong></td><td><strong>3</strong></td><td>3</td><td><span style=color:#59ae01;font-weight:700>UP</span></td></tr><tr><td><strong>2</strong></td><td><strong>4</strong></td><td>2</td><td><span style=color:red;font-weight:700>Down</span></td></tr><tr><td><strong>1</strong></td><td><strong>5</strong></td><td>1</td><td><span style=color:red;font-weight:700>Down</span></td></tr></tbody></table><h3 id=333-architecture-etcd-de-linfrastructure>3.3.3. architecture etcd de l&rsquo;infrastructure <a href=#333-architecture-etcd-de-linfrastructure class=anchor aria-hidden=true>#</a></h3><p>Notre choix est porté sur le stacked etcd cluster qui en terme de haute disponibilité respecte les standards.</p><h3 id=4-volumes>4. Volumes <a href=#4-volumes class=anchor aria-hidden=true>#</a></h3><p><img class="img-fluid lazyload blur-up" srcset="../../../images/kube-master-volumes_hu03808ede9e1a3bbbed389ccc427133a5_120545_c379894d6ebb5ab1128f134f41f8580a.webp 480w, ../../../images/kube-master-volumes_hu03808ede9e1a3bbbed389ccc427133a5_120545_20a03a86bb314f361fe8193b4fa48786.webp 720w, ../../../images/kube-master-volumes_hu03808ede9e1a3bbbed389ccc427133a5_120545_ecfca0be28388d61c13047b4038864ee.webp 1080w, ../../../images/kube-master-volumes_hu03808ede9e1a3bbbed389ccc427133a5_120545_352d9e23c4ed299b7e56a402482ee17e.webp 1280w, ../../../images/kube-master-volumes_hu03808ede9e1a3bbbed389ccc427133a5_120545_df71837385fda67b022264a40970a4eb.webp 1600w, ../../../images/kube-master-volumes_hu03808ede9e1a3bbbed389ccc427133a5_120545_1676x0_resize_q75_h2_box_3.webp 1676w" sizes=80vw src=../../../images/kube-master-volumes_hu03808ede9e1a3bbbed389ccc427133a5_120545_1676x0_resize_q75_h2_box_3.webp alt=external-etcd-cluster width=1676 height=1090></p><h2 id=9-bilan>9. Bilan <a href=#9-bilan class=anchor aria-hidden=true>#</a></h2><div class="page-footer-meta d-flex flex-column flex-md-row justify-content-between"></div><div class="docs-navigation d-flex justify-content-between"><a href=../../../docs/authentification/kibana/><div class="card my-1"><div class="card-body py-2">&larr; Kibana</div></div></a><a class=ms-auto href=../../../docs/authentification/prometheus/><div class="card my-1"><div class="card-body py-2">Prometheus &rarr;</div></div></a></div></main></div></div></div><footer class="footer text-muted"><div class=container-xxl><div class=row><div class="col-lg-8 order-last order-lg-first"><ul class=list-inline><li class=list-inline-item>Réalisé et rédigé par Doudou FALL (Développer FullStack / DevOps)</li></ul></div><div class="col-lg-8 order-first order-lg-last text-lg-end"><ul class=list-inline></ul></div></div></div></footer><script src=../../../js/bootstrap.min.223fd2b247a18dd9421f5eac2b8f740a338445314a3282ea82752d0b792e51c8d367c12fd27ceb7c011214399deee96a6fdfc51943f9bbef1aa079653d1e4bdc.js integrity="sha512-Ij/SskehjdlCH16sK490CjOERTFKMoLqgnUtC3kuUcjTZ8Ev0nzrfAESFDmd7ulqb9/FGUP5u+8aoHllPR5L3A==" crossorigin=anonymous defer></script>
<script src=../../../js/highlight.min.d818f1562eeb78fbb22db13bca8afb220a843ef6c56d85f3b980f74c5d459b089c927f58117ae974ad0033c8b8984bbfe242e331c558a2d8ba3e48e6f672a92f.js integrity="sha512-2BjxVi7rePuyLbE7yor7IgqEPvbFbYXzuYD3TF1Fmwickn9YEXrpdK0AM8i4mEu/4kLjMcVYoti6Pkjm9nKpLw==" crossorigin=anonymous defer></script>
<script src=../../../main.min.21c6f70b45aa989b1d40f6863a3686f261435590aee6754b74a2f061b514e20cc8a201eb4317d2f0fbff54e61f3d7c46a7f15f1ae398c7f3a6147a91dd04b840.js integrity="sha512-Icb3C0WqmJsdQPaGOjaG8mFDVZCu5nVLdKLwYbUU4gzIogHrQxfS8Pv/VOYfPXxGp/FfGuOYx/OmFHqR3QS4QA==" crossorigin=anonymous defer></script>
<script src=../../../index.min.a0b682887cd96f8972b91126f589ad741fefef6ab91510d619b0820a900f150a1dbc5387a27e94ee29bc672d5420391e493216b1e4db8b406ed87c9acc946056.js integrity="sha512-oLaCiHzZb4lyuREm9YmtdB/v72q5FRDWGbCCCpAPFQodvFOHon6U7im8Zy1UIDkeSTIWseTbi0Bu2HyazJRgVg==" crossorigin=anonymous defer></script></body></html>